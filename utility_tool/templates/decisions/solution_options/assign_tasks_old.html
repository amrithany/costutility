{% extends 'index.html' %}
{% load static %}
{% block body_block %}
{% load tz %}

<div class="hero-unit">
    <div style="color:#0000FF" align="left"><h4>Decision you are working on: {{dec_title}}</h4></div>
    <div class="container-fluid">
   <form id="form1" method="post"  enctype="multipart/form-data">
       {% csrf_token %}
        <h3 class="form-signin-heading">Assign Tasks to the Stakeholders for this Decision</h3>
        <h5 style="border: 2px solid grey;padding-left: 15px;">
            <br>You can assign stakeholders to different tasks now, or come back later to do this
            <br><br>For each stakeholder, check each task in which you would like them to participate online via <i>DecisionMaker</i> and click on “Save and Back to Flowchart”
            <br><br>If you wish to remove a stakeholder from this list, check the box next to the stakeholder's name and click on “Delete Stakeholders from this list”

            <br><br></h5>
        <br>
            <input class="btn btn-primary" type="submit" name="submit" id="submit" value="Save and Back to Flowchart"/>&nbsp;     
            <input class="btn btn-primary" type="submit" name="submit2" value="Delete Stakeholders from this list"/>&nbsp; 
            <a href="/utility_tool/stakeholders/stakeholders.html"><input class="btn btn-success" type="button" name="add" value="Add another Stakeholder"/></a><br>
            <table class="table table-condensed">
                <thead>
                    <th></th>
                    <th nowrap>First Name</th>
                    <th>Last Name</th>
                    <th>Title</th>
                    <th>Organization</th>
                    <th style="text-align: center;">Suggest Solution Options</th>
                    <th style="text-align: center;">Provide Screening Criteria</th>
                    <th style="text-align: center;">Provide Evaluation Criteria</th>
                    <th style="text-align: center;">Contribute Importance Scores</th>
                    <br />
                    {% localtime on %}
                    {% for st in st_dec %}
                           <tr onmouseover="javascript:style.background='#dcfac9'" onmouseout="javascript:style.background='#DCDCDC'" bgcolor="#DCDCDC">
                               <td><input type="checkbox" id="{{st.id}}" value="{{st.id}}" name="id"  onclick="setId2(this);" style="margin-left:auto; margin-right:auto;"></td>
                            <td>{{st.firstName}}</td>
                            <td>{{st.lastName}}</td>
                            <td>{{st.title}}</td>
                            <td>{{st.organisation}}</td>
                            <td style="text-align: center;"><input type="checkbox" name="solopt" id="{{st.id}}solopt" value="{{st.solopt_type}}"> </td>
                            <td style="text-align: center;"><input type="checkbox" name="scrcr" id="{{st.id}}scrcr"> </td>
                            <td style="text-align: center;"><input type="checkbox" id="{{st.id}}evacr" value="{{st.scrcr_type}}"> </td>
                            <td style="text-align: center;"><input type="checkbox" id="{{st.id}}iw"> </td>
                        </tr>
                    </thead>    
                   <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
                   <script type="text/javascript">
                     var selected = [];
                     var deleted = [];
                     var passvar = '{{ dec_id }}';
                   
                     
                     $(document).ready(function () {
                         {% for st in stdec_type %}
                           stid = '{{st.st_id}}';
                           solopt = '{{st.solopt_type}}';
                           scrcr = '{{st.scrcr_type}}';
                           evacr = '{{st.evacr_type}}';
                           iw = '{{st.iw_type}}';
  
                           if (solopt == "Y") { 
                              $("#{{st.st_id}}solopt").prop("checked", true);
                           }
                           if (scrcr == "Y") { 
                              $("#{{st.st_id}}scrcr").prop("checked", true);
                           }
                           if (evacr == "Y") { 
                              $("#{{st.st_id}}evacr").prop("checked", true);
                           }
                           if (iw == "Y") { 
                              $("#{{st.st_id}}iw").prop("checked", true);
                           }
                         {% endfor %}
                     });   
 
                     function setId2(chkBox){
                          var inputs = document.getElementsByTagName("input");
                          for (i = 0; i<inputs.length; i++ ) {
                             if (inputs[i].type == 'checkbox'){
                                if (inputs[i].id == chkBox.id) {
                                       deleted.push(chkBox.id);
                                   }
                             }
                          }
                     }

                     $('#submit').off('click');
                     $("#submit").on('click', function (e) {
                        var selected = [];     
                        e.preventDefault();
                        var solopt_id = $("#{{st.id}}solopt").attr('id');
                        var scrcr_id = $("#{{st.id}}scrcr").attr('id');
                        var evacr_id = $("#{{st.id}}evacr").attr('id');
                        var iw_id = $("#{{st.id}}iw").attr('id');

                        if ($("#{{st.id}}solopt").is(":checked")) { 
                             solopt_id = solopt_id + "Y";
                             selected.push(solopt_id);
                        } else { 
                             solopt_id = solopt_id + "N";
                             selected.push(solopt_id);
                        }
                        if ($("#{{st.id}}scrcr").is(":checked")) { 
                             scrcr_id = scrcr_id + "Y";
                             selected.push(scrcr_id);                                                                                                                                                           
                        } else { 
                             scrcr_id = scrcr_id + "N";
                             selected.push(scrcr_id);
                        } 
                        if ($("#{{st.id}}evacr").is(":checked")) {  
                             evacr_id = evacr_id + "Y";
                             selected.push(evacr_id);                                                                                                                                                           
                        } else { 
                             evacr_id = evacr_id + "N";
                             selected.push(evacr_id);
                        }
                        if ($("#{{st.id}}iw").is(":checked")) {  
                             iw_id = iw_id + "Y";
                             selected.push(iw_id);                                                                                                                                                           
                        } else { 
                             iw_id = iw_id + "N";
                             selected.push(iw_id);
                        }
                        //for (var i in selected) {
                            //alert(selected[i]);
                        //}
                        if (selected != []){
                            $.ajax({
                             type:"POST",
                             url:"{% url 'assign_tasks' %}",
                             data: {
                                csrfmiddlewaretoken: document.getElementsByName('csrfmiddlewaretoken')[0].value,
                                'selected':JSON.stringify(selected),
                                'id': '{{st.id}}',
                                },
                              success: function(){
                              //alert('success');
                              //window.location.reload();
                              window.location.href = "/utility_tool/decisions/" + {{dec_id}} + "/menu.html"; 
                              },
                              error: function(){
                              //alert('failure');
                             }   
                         });
                        }    
            return false;
                                                                                                                                                                                                                 
            });                     
            </script>
            {% endfor %}                                                                                                                                                                                 
            {% endlocaltime %} 
            </table>
    </form>
    </div>
</div>
{% endblock %}



